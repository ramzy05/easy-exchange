{% extends 'base.html' %}
{% load static %}

{% block title %}
    Register
{% endblock title %}

{% block content %}
<div class="main-content form">


    <div class="grid form">
        <h2>Registration</h2>
        <div class="form-container signup">
            <div id="message-box" class="">
                <p>This field is required</p>
            </div>
            <form action="" method="post" id="signup-form">
                {%csrf_token%}
                
                <div>
                    <div class="form-control">
                        {{form.username.label_tag}}
                        {{form.username}}
                    </div>
                    <div class="form-control">
                        {{form.first_name.label_tag}}
                        {{form.first_name}}
                    </div>
                    <div class="form-control">
                        {{form.last_name.label_tag}}
                        {{form.last_name}}
                    </div>
                
                    <div class="form-control">
                        {{form.country.label_tag}}
                        {{form.country}}
                    </div>
                    <div class="form-control">
                        {{form.password1.label_tag}}
                        {{form.password1}}
                    </div>
                    <div class="form-control">
                        {{form.password2.label_tag}}
                        {{form.password2}}
                    </div>
                </div>
                <button type="submit" id="submit-btn">Register</button>
                <p>Already have an account ? <a href="{% url 'login' %}"  class="cta">Log In</a></p>
            </form>
        </div>
    </div>
</div>
{% endblock content %}


{% block scripts %}
<script src="{% static 'js/display_message.js' %}"></script>


<script >
    function handleAccountCreateFormDidSubmit(event){
        event.preventDefault()
        const myForm = event.target
        const myFormData = new FormData(myForm)
        const url = myForm.getAttribute('action')
        const method = myForm.getAttribute('method')
        const xhr = new XMLHttpRequest()
        const responseType = 'json'
        xhr.responseType = responseType
        xhr.open(method, url)
        xhr.onload =  function(){
            if(xhr.status === 201){
                // console.log(xhr.response)
                displayMessage('Your account has been successfull created', 'success')
                // myForm.reset()
                redirect(xhr.response.url)
            } else if(xhr.status === 400){
                const formErrors = getAllErrors(xhr.response.errors)
                displayMessage(formErrors[0], 'error')
                
            //    console.log(xhr.response)
                   
               
            }else if (status === 500){
                alert('There was a server error, please try again.')
            }
        }
        xhr.onerror = function(){
            alert('An error occured, Please try again later.')
        }
        xhr.send(myFormData)
    }
    const signupForm = document.getElementById('signup-form')
    signupForm.addEventListener('submit', handleAccountCreateFormDidSubmit)
</script>    
{% endblock scripts %}
