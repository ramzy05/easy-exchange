{% extends 'base.html' %}

{% block title %}
    Login
{% endblock title %}

{% block content %}
<div class="form-container">
    <form action="" method="post" id="signin-form">
        {%csrf_token%}
        <div class="form-control">
            {{form.username.label_tag}}
            {{form.username}}
            <div class="errors"></div>
        </div>
        <div class="form-control">
            {{form.password1.label_tag}}
            {{form.password1}}
            <div class="errors"></div>
        </div>
    
        <button type="submit" id="submit-btn">Log In</button>
    </form>
</div>

{% endblock content %}


{% block scripts %}
<script >

    function handleAccountCreateFormDidSubmit(event){
        event.preventDefault()
        const myForm = event.target
        const myFormData = new FormData(myForm)
        const url = myForm.getAttribute('action')
        const method = myForm.getAttribute('method')
        const csrftoken = getCookie('csrftoken')
        const xhr = new XMLHttpRequest()
        const responseType = 'json'
        xhr.responseType = responseType
        xhr.open(method, url)
        xhr.setRequestHeader('X-CSRFToken', csrftoken)
        xhr.onload =  function(){
            if(xhr.status === 200){
                console.log(xhr.response)
                myForm.reset()
            } else if(xhr.status === 400){
               console.log(xhr.response)
                   
               
            }else if (status === 500){
                alert('There was a server error, please try again.')
            }
        }
        xhr.onerror = function(){
            alert('An error occured, Please try again later.')
        }
        xhr.send(myFormData)
    }
    const signinForm = document.getElementById('signin-form')
    signinForm.addEventListener('submit', handleAccountCreateFormDidSubmit)
    console.log(signinForm)
</script>    
{% endblock scripts %}
